<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>New Password - Smart Tiffin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 flex items-center justify-center h-screen font-sans">

<div class="bg-white p-8 rounded-2xl shadow-xl w-96">
  <h2 class="text-xl font-bold text-center text-gray-800 mb-6">Set New Password</h2>

  <form action="/reset-password" method="post" onsubmit="return validateResetForm()">
    <input type="hidden" name="token" th:value="${token}">

    <!-- New Password -->
    <div class="mb-4 relative">
      <input type="password" id="newPassword" name="password" placeholder="New Password (min 6 chars)" required
             class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none pr-10">
      <i class="fas fa-eye absolute right-3 top-3 text-gray-400 cursor-pointer hover:text-orange-600"
         id="toggleReset1" onclick="toggleVisibility('newPassword', 'toggleReset1')"></i>
    </div>

    <!-- Confirm Password -->
    <div class="mb-2 relative">
      <input type="password" id="confirmReset" placeholder="Confirm New Password" required
             class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 outline-none pr-10">
      <i class="fas fa-eye absolute right-3 top-3 text-gray-400 cursor-pointer hover:text-orange-600"
         id="toggleReset2" onclick="toggleVisibility('confirmReset', 'toggleReset2')"></i>
    </div>

    <!-- Error Messages -->
    <p id="resetLengthError" class="text-red-500 text-xs mb-2 hidden"><i class="fas fa-times-circle mr-1"></i> Min 6 characters required.</p>
    <p id="resetMatchError" class="text-red-500 text-xs mb-6 hidden"><i class="fas fa-times-circle mr-1"></i> Passwords do not match.</p>

    <button type="submit" class="w-full bg-orange-600 text-white font-bold py-2 rounded-lg hover:bg-orange-700 transition shadow-lg">
      Change Password
    </button>
  </form>
</div>

<script>
  function toggleVisibility(inputId, iconId) {
      const input = document.getElementById(inputId);
      const icon = document.getElementById(iconId);
      if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
      } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
      }
  }

  function validateResetForm() {
      const pass = document.getElementById('newPassword').value;
      const confirm = document.getElementById('confirmReset').value;

      let isValid = true;

      // Length Check
      if (pass.length < 6) {
          document.getElementById('resetLengthError').classList.remove('hidden');
          isValid = false;
      } else {
          document.getElementById('resetLengthError').classList.add('hidden');
      }

      // Match Check
      if (pass !== confirm) {
          document.getElementById('resetMatchError').classList.remove('hidden');
          isValid = false;
      } else {
          document.getElementById('resetMatchError').classList.add('hidden');
      }

      return isValid;
  }
</script>
</body>
</html>